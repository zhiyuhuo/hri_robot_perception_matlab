clc;
clear;
close all;
%

data = load('apartment_normal_data_1d.mat');
data = data.data;
X = data.X;
Y = data.Y;
idx_train = randsample(size(X,2), size(X,2) * 2/3);
idx_test = setdiff([1:size(X,2)], idx_train);
Xtrain = X(:,idx_train);
XTest = X(:,)
T = zeros(max(Y), length(Y));
for i = 1:size(T,2)
    T(Y(i), i) = 1;
end

%%%%%%%train dnn for 200-len feature
hiddenSize = 512;
autoenc1 = trainAutoencoder(X1,hiddenSize,...
    'L2WeightRegularization',0.001,...
    'SparsityRegularization',4,...
    'SparsityProportion',0.05,...
    'DecoderTransferFunction','purelin');
X2 = encode(autoenc1, X1);

hiddenSize = 128;
autoenc2 = trainAutoencoder(X2,hiddenSize,...
    'L2WeightRegularization',0.001,...
    'SparsityRegularization',4,...
    'SparsityProportion',0.05,...
    'DecoderTransferFunction','purelin');
X3 = encode(autoenc2, X2);

hiddenSize = 32;
autoenc3 = trainAutoencoder(X3,hiddenSize,...
    'L2WeightRegularization',0.001,...
    'SparsityRegularization',4,...
    'SparsityProportion',0.05,...
    'DecoderTransferFunction','purelin');
X4 = encode(autoenc3, X3);

softnet1 = trainSoftmaxLayer(X4,T,'LossFunction','crossentropy','MaxEpochs',400);
view(softnet1);
deepnet = stack(autoenc1,autoenc2,autoenc3,softnet1);
deepnet = train(deepnet,X1,T);

y = deepnet(X1);
plotconfusion(T,y);











